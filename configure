#!/bin/sh

# Library settings
PKG_CONFIG_NAME="rgemmacpp"
PKG_LIBS="build/_deps/gemma-build/libgemma.a build/_deps/highway-build/libhwy.a build/_deps/sentencepiece-build/src/libsentencepiece.a"
PKG_CFLAGS="-Ibuild/_deps/gemma-src/ -Ibuild/_deps/highway-src/ -Ibuild/_deps/sentencepiece-src/"

cd src/
cmake -B build
cd build
make -j8 libgemma sentencepiece-static

cd ../../



# Write to Makevars
sed -e "s|@cflags@|$PKG_CFLAGS|" -e "s|@libs@|$PKG_LIBS|" src/Makevars.in > src/Makevars

# Success
echo "Configuration OK!"
exit 0
